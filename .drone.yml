kind: pipeline
name: deployment

steps:
- name: deploy
  image: appleboy/drone-ssh
  settings:
    host:
      - 192.168.68.121
    username: vylpes
    password:
      from_secret: ssh_password
    port: 22
    command_timeout: 10m
    script:
      - sh /home/vylpes/scripts/vylbot/deploy_prod.sh

trigger:
  event:
  - promote
  target:
  - production

---

kind: pipeline
name: staging

steps:
- name: deploy
  image: appleboy/drone-ssh
  settings:
    host:
      - 192.168.68.121
    username: vylpes
    password:
      from_secret: ssh_password
    port: 22
    command_timeout: 10m
    script:
      - sh /home/vylpes/scripts/vylbot/deploy_stage.sh

trigger:
  branch:
  - develop
  event:
  - push

---

kind: pipeline
name: integration

steps:
- name: build
  image: node
  commands:
  - yarn install --frozen-lockfile
  - yarn build

- name: test
  image: node
  commands:
  - yarn install --frozen-lockfile
  - yarn test

trigger:
  branch:
  - main
  - develop
  - hotfix/*
  - feature/*
  - renovate/*
  event:
  - push
  - pull_request